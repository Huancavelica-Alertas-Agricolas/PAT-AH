2025-11-28T00:37:06.4111917Z ##[group]Run echo "Building ai-service image for integration tests (service context)..."
2025-11-28T00:37:06.4112500Z [36;1mecho "Building ai-service image for integration tests (service context)..."[0m
2025-11-28T00:37:06.4113120Z [36;1m# Use the service directory as the docker build context so paths like trained-models exist relative to Dockerfile[0m
2025-11-28T00:37:06.4113688Z [36;1mdocker build -t pat-ah/ai-service:ci -f Dockerfile . || true[0m
2025-11-28T00:37:06.4114087Z [36;1mecho "Running tests for ai-service (unit + container E2E)..."[0m
2025-11-28T00:37:06.4114532Z [36;1mnpm test -- --passWithNoTests || ( echo "ai-service tests failed" && exit 1 )[0m
2025-11-28T00:37:06.4147070Z shell: /usr/bin/bash -e {0}
2025-11-28T00:37:06.4147295Z ##[endgroup]
2025-11-28T00:37:06.4201099Z Building ai-service image for integration tests (service context)...
2025-11-28T00:37:06.6454521Z #0 building with "default" instance using docker driver
2025-11-28T00:37:06.6455060Z 
2025-11-28T00:37:06.6455424Z #1 [internal] load build definition from Dockerfile
2025-11-28T00:37:06.6456192Z #1 transferring dockerfile: 1.59kB done
2025-11-28T00:37:06.6456720Z #1 DONE 0.0s
2025-11-28T00:37:06.6456925Z 
2025-11-28T00:37:06.6457337Z #2 [internal] load metadata for docker.io/library/node:20
2025-11-28T00:37:06.6457898Z #2 DONE 0.0s
2025-11-28T00:37:06.6458097Z 
2025-11-28T00:37:06.6458491Z #3 [internal] load metadata for docker.io/library/node:20-slim
2025-11-28T00:37:06.6459182Z #3 DONE 0.1s
2025-11-28T00:37:06.7643937Z 
2025-11-28T00:37:06.7645121Z #4 [internal] load .dockerignore
2025-11-28T00:37:06.7646021Z #4 transferring context: 2B done
2025-11-28T00:37:06.7646721Z #4 DONE 0.0s
2025-11-28T00:37:06.7646951Z 
2025-11-28T00:37:06.7647281Z #5 [builder 1/8] FROM docker.io/library/node:20
2025-11-28T00:37:06.7647758Z #5 DONE 0.0s
2025-11-28T00:37:06.7647999Z 
2025-11-28T00:37:06.7648975Z #6 [stage-1 1/6] FROM docker.io/library/node:20-slim@sha256:fbb357f69d05c97333855b0846e4ef65462409728312df3c9ff12c941741c0a5
2025-11-28T00:37:06.7650124Z #6 DONE 0.0s
2025-11-28T00:37:06.7650297Z 
2025-11-28T00:37:06.7650544Z #7 [stage-1 2/6] WORKDIR /usr/src/app
2025-11-28T00:37:06.7650962Z #7 CACHED
2025-11-28T00:37:06.7651131Z 
2025-11-28T00:37:06.7652269Z #8 [stage-1 3/6] RUN apt-get update -y && apt-get install -y openssl ca-certificates curl iproute2 procps --no-install-recommends && rm -rf /var/lib/apt/lists/*
2025-11-28T00:37:06.7653300Z #8 CACHED
2025-11-28T00:37:06.7653482Z 
2025-11-28T00:37:06.7653701Z #9 [internal] load build context
2025-11-28T00:37:09.8938015Z #9 transferring context: 464.02MB 3.0s done
2025-11-28T00:37:09.8938555Z #9 DONE 3.1s
2025-11-28T00:37:09.8938764Z 
2025-11-28T00:37:09.8939195Z #10 [builder 2/8] WORKDIR /usr/src/app
2025-11-28T00:37:09.8939588Z #10 CACHED
2025-11-28T00:37:09.8939749Z 
2025-11-28T00:37:09.8939991Z #11 [builder 3/8] COPY package*.json ./
2025-11-28T00:37:10.9682464Z #11 DONE 1.2s
2025-11-28T00:37:11.1194154Z 
2025-11-28T00:37:11.1195741Z #12 [builder 4/8] RUN apt-get update -y && apt-get install -y openssl ca-certificates --no-install-recommends && rm -rf /var/lib/apt/lists/*  && npm ci --legacy-peer-deps --no-audit --no-fund
2025-11-28T00:37:11.1272476Z #12 0.158 Get:1 http://deb.debian.org/debian bookworm InRelease [151 kB]
2025-11-28T00:37:11.2721771Z #12 0.176 Get:2 http://deb.debian.org/debian bookworm-updates InRelease [55.4 kB]
2025-11-28T00:37:11.2723100Z #12 0.183 Get:3 http://deb.debian.org/debian-security bookworm-security InRelease [48.0 kB]
2025-11-28T00:37:11.2724174Z #12 0.238 Get:4 http://deb.debian.org/debian bookworm/main amd64 Packages [8791 kB]
2025-11-28T00:37:11.2725213Z #12 0.303 Get:5 http://deb.debian.org/debian bookworm-updates/main amd64 Packages [6924 B]
2025-11-28T00:37:11.4736226Z #12 0.354 Get:6 http://deb.debian.org/debian-security bookworm-security/main amd64 Packages [288 kB]
2025-11-28T00:37:12.0377254Z #12 1.069 Fetched 9341 kB in 1s (10.0 MB/s)
2025-11-28T00:37:12.4091758Z #12 1.069 Reading package lists...
2025-11-28T00:37:12.7966367Z #12 1.456 Reading package lists...
2025-11-28T00:37:12.9799892Z #12 1.837 Building dependency tree...
2025-11-28T00:37:12.9800644Z #12 1.911 Reading state information...
2025-11-28T00:37:12.9801480Z #12 2.011 openssl is already the newest version (3.0.17-1~deb12u3).
2025-11-28T00:37:12.9802274Z #12 2.011 openssl set to manually installed.
2025-11-28T00:37:12.9803189Z #12 2.011 ca-certificates is already the newest version (20230311+deb12u1).
2025-11-28T00:37:12.9803968Z #12 2.011 0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
2025-11-28T00:37:15.3360308Z #12 4.367 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
2025-11-28T00:37:15.4761049Z #12 4.507 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
2025-11-28T00:37:21.0452428Z #12 10.08 
2025-11-28T00:37:21.0453672Z #12 10.08 added 539 packages in 8s
2025-11-28T00:37:21.1970305Z #12 10.08 npm notice
2025-11-28T00:37:21.1971060Z #12 10.08 npm notice New major version of npm available! 10.8.2 -> 11.6.4
2025-11-28T00:37:21.1971997Z #12 10.08 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.4
2025-11-28T00:37:21.1972802Z #12 10.08 npm notice To update run: npm install -g npm@11.6.4
2025-11-28T00:37:21.1973306Z #12 10.08 npm notice
2025-11-28T00:37:22.1644076Z #12 DONE 11.2s
2025-11-28T00:37:22.3153936Z 
2025-11-28T00:37:22.3154437Z #13 [builder 5/8] COPY . ./
2025-11-28T00:37:28.3732385Z #13 DONE 6.2s
2025-11-28T00:37:28.5012804Z 
2025-11-28T00:37:28.5014039Z #14 [builder 6/8] RUN mkdir -p /usr/src/app/trained-models
2025-11-28T00:37:28.5014638Z #14 DONE 0.1s
2025-11-28T00:37:28.6283937Z 
2025-11-28T00:37:28.6285490Z #15 [builder 7/8] RUN mkdir -p prisma && cp ../shared/prisma/schema.prisma prisma/schema.prisma || true
2025-11-28T00:37:28.6286666Z #15 0.126 cp: cannot stat '../shared/prisma/schema.prisma': No such file or directory
2025-11-28T00:37:28.7862301Z #15 DONE 0.1s
2025-11-28T00:37:28.7862525Z 
2025-11-28T00:37:28.7863051Z #16 [builder 8/8] RUN if [ -f "prisma/schema.prisma" ]; then npx prisma generate --schema=prisma/schema.prisma; fi
2025-11-28T00:37:29.4531167Z #16 0.817 Prisma schema loaded from prisma/schema.prisma
2025-11-28T00:37:29.7494863Z #16 1.114 
2025-11-28T00:37:29.7495876Z #16 1.114 ✔ Generated Prisma Client (v5.22.0) to ./node_modules/@prisma/client in 77ms
2025-11-28T00:37:29.7496325Z #16 1.114 
2025-11-28T00:37:29.7496825Z #16 1.114 Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-11-28T00:37:29.7497313Z #16 1.114 
2025-11-28T00:37:29.7497756Z #16 1.114 Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-11-28T00:37:29.7498164Z #16 1.114 
2025-11-28T00:37:29.9747985Z #16 DONE 1.3s
2025-11-28T00:37:30.3723769Z 
2025-11-28T00:37:30.3730736Z #17 [stage-1 4/6] COPY --from=builder /usr/src/app/src ./src
2025-11-28T00:37:30.5368084Z #17 DONE 0.0s
2025-11-28T00:37:31.6428896Z 
2025-11-28T00:37:31.6429938Z #18 [stage-1 5/6] COPY --from=builder /usr/src/app/node_modules ./node_modules
2025-11-28T00:37:35.3678451Z #18 DONE 3.7s
2025-11-28T00:37:35.5421942Z 
2025-11-28T00:37:35.5423094Z #19 [stage-1 6/6] COPY --from=builder /usr/src/app/trained-models ./trained-models
2025-11-28T00:37:35.5424083Z #19 DONE 0.0s
2025-11-28T00:37:35.5428936Z 
2025-11-28T00:37:35.5429358Z #20 exporting to image
2025-11-28T00:37:35.5429745Z #20 exporting layers
2025-11-28T00:37:38.7174700Z #20 exporting layers 3.3s done
2025-11-28T00:37:38.7642376Z #20 writing image sha256:bcfe3d4e743fde619b8b59adf21eb073abdae2fd845b2d3e08f8aeef984f0a6f done
2025-11-28T00:37:38.7643706Z #20 naming to docker.io/pat-ah/ai-service:ci done
2025-11-28T00:37:38.7644186Z #20 DONE 3.3s
2025-11-28T00:37:38.7688298Z Running tests for ai-service (unit + container E2E)...
2025-11-28T00:37:38.8737445Z 
2025-11-28T00:37:38.8737936Z > ai-service@0.1.0 test
2025-11-28T00:37:38.8738337Z > jest --runInBand --passWithNoTests
2025-11-28T00:37:38.8738848Z 
2025-11-28T00:37:39.6313741Z #0 building with "default" instance using docker driver
2025-11-28T00:37:39.6314318Z 
2025-11-28T00:37:39.6314670Z #1 [internal] load build definition from Dockerfile
2025-11-28T00:37:39.8141947Z #1 transferring dockerfile: 1.59kB done
2025-11-28T00:37:39.8142861Z #1 DONE 0.0s
2025-11-28T00:37:39.8143744Z 
2025-11-28T00:37:39.8144444Z #2 [internal] load metadata for docker.io/library/node:20
2025-11-28T00:37:39.8145449Z #2 DONE 0.0s
2025-11-28T00:37:39.8152333Z 
2025-11-28T00:37:39.8152788Z #3 [internal] load metadata for docker.io/library/node:20-slim
2025-11-28T00:37:39.8153377Z #3 DONE 0.1s
2025-11-28T00:37:39.8153559Z 
2025-11-28T00:37:39.8153778Z #4 [internal] load .dockerignore
2025-11-28T00:37:39.8154253Z #4 transferring context: 2B done
2025-11-28T00:37:39.8154621Z #4 DONE 0.0s
2025-11-28T00:37:39.8154781Z 
2025-11-28T00:37:39.8155613Z #5 [stage-1 1/6] FROM docker.io/library/node:20-slim@sha256:fbb357f69d05c97333855b0846e4ef65462409728312df3c9ff12c941741c0a5
2025-11-28T00:37:39.8156515Z #5 DONE 0.0s
2025-11-28T00:37:39.8156708Z 
2025-11-28T00:37:39.8157015Z #6 [builder 1/8] FROM docker.io/library/node:20
2025-11-28T00:37:39.8157479Z #6 DONE 0.0s
2025-11-28T00:37:39.8157654Z 
2025-11-28T00:37:39.8157869Z #7 [internal] load build context
2025-11-28T00:37:40.5953169Z #7 transferring context: 1.70MB 0.8s done
2025-11-28T00:37:40.5953586Z #7 DONE 0.8s
2025-11-28T00:37:40.5953712Z 
2025-11-28T00:37:40.5954417Z #8 [builder 8/8] RUN if [ -f "prisma/schema.prisma" ]; then npx prisma generate --schema=prisma/schema.prisma; fi
2025-11-28T00:37:40.5955044Z #8 CACHED
2025-11-28T00:37:40.5955186Z 
2025-11-28T00:37:40.5956310Z #9 [builder 4/8] RUN apt-get update -y && apt-get install -y openssl ca-certificates --no-install-recommends && rm -rf /var/lib/apt/lists/*  && npm ci --legacy-peer-deps --no-audit --no-fund
2025-11-28T00:37:40.5957600Z #9 CACHED
2025-11-28T00:37:40.5957796Z 
2025-11-28T00:37:40.5957973Z #10 [builder 5/8] COPY . ./
2025-11-28T00:37:40.5958322Z #10 CACHED
2025-11-28T00:37:40.5958488Z 
2025-11-28T00:37:40.5958659Z #11 [builder 2/8] WORKDIR /usr/src/app
2025-11-28T00:37:40.5958899Z #11 CACHED
2025-11-28T00:37:40.5959169Z 
2025-11-28T00:37:40.5959692Z #12 [builder 7/8] RUN mkdir -p prisma && cp ../shared/prisma/schema.prisma prisma/schema.prisma || true
2025-11-28T00:37:40.5960267Z #12 CACHED
2025-11-28T00:37:40.5960427Z 
2025-11-28T00:37:40.5960610Z #13 [stage-1 2/6] WORKDIR /usr/src/app
2025-11-28T00:37:40.5961010Z #13 CACHED
2025-11-28T00:37:40.5961180Z 
2025-11-28T00:37:40.5961544Z #14 [builder 6/8] RUN mkdir -p /usr/src/app/trained-models
2025-11-28T00:37:40.5962067Z #14 CACHED
2025-11-28T00:37:40.5962207Z 
2025-11-28T00:37:40.5962413Z #15 [stage-1 4/6] COPY --from=builder /usr/src/app/src ./src
2025-11-28T00:37:40.5962690Z #15 CACHED
2025-11-28T00:37:40.5962786Z 
2025-11-28T00:37:40.5963099Z #16 [stage-1 5/6] COPY --from=builder /usr/src/app/node_modules ./node_modules
2025-11-28T00:37:40.5963674Z #16 CACHED
2025-11-28T00:37:40.5963804Z 
2025-11-28T00:37:40.5964851Z #17 [stage-1 3/6] RUN apt-get update -y && apt-get install -y openssl ca-certificates curl iproute2 procps --no-install-recommends && rm -rf /var/lib/apt/lists/*
2025-11-28T00:37:40.5965834Z #17 CACHED
2025-11-28T00:37:40.5966013Z 
2025-11-28T00:37:40.5966267Z #18 [builder 3/8] COPY package*.json ./
2025-11-28T00:37:40.5966687Z #18 CACHED
2025-11-28T00:37:40.5966851Z 
2025-11-28T00:37:40.5967308Z #19 [stage-1 6/6] COPY --from=builder /usr/src/app/trained-models ./trained-models
2025-11-28T00:37:40.5967922Z #19 CACHED
2025-11-28T00:37:40.5968056Z 
2025-11-28T00:37:40.5968152Z #20 exporting to image
2025-11-28T00:37:40.5968669Z #20 exporting layers done
2025-11-28T00:37:40.5969576Z #20 writing image sha256:bcfe3d4e743fde619b8b59adf21eb073abdae2fd845b2d3e08f8aeef984f0a6f done
2025-11-28T00:37:40.5970201Z #20 naming to docker.io/library/ai-int-test-image:1764290259522 done
2025-11-28T00:37:40.5970512Z #20 DONE 0.0s
2025-11-28T00:37:40.6558867Z   console.log
2025-11-28T00:37:40.6560269Z     [ai-container] 48abd825da17fd75c93b0618323e54a994a3364f21e6eaf71f1793ca9e719f93
2025-11-28T00:37:40.6560820Z 
2025-11-28T00:37:40.6561267Z       at Socket.log (test/integration/weather-http.integration.test.js:80:69)
2025-11-28T00:37:40.6561750Z 
2025-11-28T00:37:42.0635488Z Could not load @tensorflow/tfjs-node native bindings. Falling back to @tensorflow/tfjs (JS). Performance may be slower.
2025-11-28T00:37:42.0637905Z [31m[Nest] 1  - [39m11/28/2025, 12:37:42 AM [31m  ERROR[39m [38;5;3m[WeatherService] [39m[31mError obteniendo datos del clima: getaddrinfo ENOTFOUND host.docker.internal[39m
2025-11-28T00:37:42.0640543Z [31m[Nest] 1  - [39m11/28/2025, 12:37:42 AM [31m  ERROR[39m [38;5;3m[WeatherService] [39m[31mError obteniendo datos del clima: getaddrinfo ENOTFOUND host.docker.internal[39m
2025-11-28T00:37:42.0654364Z   console.log
2025-11-28T00:37:42.0654735Z     === ai-int-test logs ===
2025-11-28T00:37:42.0655798Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[NestFactory] [39m[32mStarting Nest application...[39m
2025-11-28T00:37:42.0657229Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[MachineLearningService] [39m[32mCargados 0 modelos desde disco[39m
2025-11-28T00:37:42.0658296Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mAppModule dependencies initialized[39m[38;5;3m +1ms[39m
2025-11-28T00:37:42.0659493Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mMulterModule dependencies initialized[39m[38;5;3m +0ms[39m
2025-11-28T00:37:42.0660476Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mAiModule dependencies initialized[39m[38;5;3m +0ms[39m
2025-11-28T00:37:42.0661380Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RoutesResolver] [39m[32mAiController {/api/ai}:[39m[38;5;3m +3ms[39m
2025-11-28T00:37:42.0662316Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/upload-excel, POST} route[39m[38;5;3m +3ms[39m
2025-11-28T00:37:42.0663281Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/train-model, POST} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:42.0664223Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/predict, POST} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:42.0665212Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/predict-with-weather, POST} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:42.0666181Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/models, GET} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:42.0667133Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/models/:id, GET} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:42.0668088Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/models/:id, DELETE} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:42.0669263Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/weather/current, GET} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:42.0671213Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/weather/forecast, GET} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:42.0673573Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/weather/status, GET} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:42.0675273Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/analyze-complete, POST} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:42.0676523Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/health, GET} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:42.0677476Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:41 AM [32m    LOG[39m [38;5;3m[NestApplication] [39m[32mNest application successfully started[39m[38;5;3m +1ms[39m
2025-11-28T00:37:42.0677905Z 
2025-11-28T00:37:42.0678157Z       at Object.log (test/integration/weather-http.integration.test.js:126:17)
2025-11-28T00:37:42.0678445Z 
2025-11-28T00:37:42.2253194Z FAIL test/integration/weather-http.integration.test.js
2025-11-28T00:37:42.2255349Z   ai-service HTTP integration with mock weather
2025-11-28T00:37:42.2258179Z     ✕ GET /ai/weather/current uses mock server data (15 ms)
2025-11-28T00:37:42.2258579Z 
2025-11-28T00:37:42.2260787Z   ● ai-service HTTP integration with mock weather › GET /ai/weather/current uses mock server data
2025-11-28T00:37:42.2261280Z 
2025-11-28T00:37:42.2261487Z     expect(received).toBe(expected) // Object.is equality
2025-11-28T00:37:42.2261745Z 
2025-11-28T00:37:42.2261835Z     Expected: true
2025-11-28T00:37:42.2262049Z     Received: false
2025-11-28T00:37:42.2262174Z 
2025-11-28T00:37:42.2262575Z     [0m [90m 137 |[39m     [36mconst[39m hostName [33m=[39m [36mawait[39m resolveHost()[33m;[39m
2025-11-28T00:37:42.2263791Z      [90m 138 |[39m     [36mconst[39m res [33m=[39m [36mawait[39m fetch([32m`http://${hostName}:${hostPort}/api/ai/weather/current?lat=-12&lon=-77`[39m[33m,[39m { timeout[33m:[39m [35m5000[39m })[33m;[39m
2025-11-28T00:37:42.2264842Z     [31m[1m>[22m[39m[90m 139 |[39m     expect(res[33m.[39mok)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
2025-11-28T00:37:42.2265368Z      [90m     |[39m                    [31m[1m^[22m[39m
2025-11-28T00:37:42.2265942Z      [90m 140 |[39m     [36mconst[39m json [33m=[39m [36mawait[39m res[33m.[39mjson()[33m;[39m
2025-11-28T00:37:42.2266723Z      [90m 141 |[39m     expect(json)[33m.[39mtoHaveProperty([32m'temperature'[39m[33m,[39m [35m25[39m)[33m;[39m
2025-11-28T00:37:42.2267608Z      [90m 142 |[39m     expect(json)[33m.[39mtoHaveProperty([32m'location'[39m[33m,[39m [32m'MockCity'[39m)[33m;[39m[0m
2025-11-28T00:37:42.2267995Z 
2025-11-28T00:37:42.2268242Z       at Object.toBe (test/integration/weather-http.integration.test.js:139:20)
2025-11-28T00:37:42.2268533Z 
2025-11-28T00:37:42.3849325Z #0 building with "default" instance using docker driver
2025-11-28T00:37:42.3849708Z 
2025-11-28T00:37:42.3850055Z #1 [internal] load build definition from Dockerfile
2025-11-28T00:37:42.5593004Z #1 transferring dockerfile: 1.59kB done
2025-11-28T00:37:42.5593689Z #1 DONE 0.0s
2025-11-28T00:37:42.5594115Z 
2025-11-28T00:37:42.5594518Z #2 [internal] load metadata for docker.io/library/node:20
2025-11-28T00:37:42.5595152Z #2 DONE 0.0s
2025-11-28T00:37:42.5595375Z 
2025-11-28T00:37:42.5595760Z #3 [internal] load metadata for docker.io/library/node:20-slim
2025-11-28T00:37:42.5596276Z #3 DONE 0.1s
2025-11-28T00:37:42.5596447Z 
2025-11-28T00:37:42.5596671Z #4 [internal] load .dockerignore
2025-11-28T00:37:42.5597142Z #4 transferring context: 2B done
2025-11-28T00:37:42.5597504Z #4 DONE 0.0s
2025-11-28T00:37:42.5597667Z 
2025-11-28T00:37:42.5597945Z #5 [builder 1/8] FROM docker.io/library/node:20
2025-11-28T00:37:42.5598377Z #5 DONE 0.0s
2025-11-28T00:37:42.5598542Z 
2025-11-28T00:37:42.5599529Z #6 [stage-1 1/6] FROM docker.io/library/node:20-slim@sha256:fbb357f69d05c97333855b0846e4ef65462409728312df3c9ff12c941741c0a5
2025-11-28T00:37:42.5600864Z #6 DONE 0.0s
2025-11-28T00:37:42.5601061Z 
2025-11-28T00:37:42.5601293Z #7 [internal] load build context
2025-11-28T00:37:43.3353110Z #7 transferring context: 1.70MB 0.8s done
2025-11-28T00:37:43.3353822Z #7 DONE 0.8s
2025-11-28T00:37:43.3354352Z 
2025-11-28T00:37:43.3355087Z #8 [builder 8/8] RUN if [ -f "prisma/schema.prisma" ]; then npx prisma generate --schema=prisma/schema.prisma; fi
2025-11-28T00:37:43.3356503Z #8 CACHED
2025-11-28T00:37:43.3356717Z 
2025-11-28T00:37:43.3357003Z #9 [builder 3/8] COPY package*.json ./
2025-11-28T00:37:43.3357724Z #9 CACHED
2025-11-28T00:37:43.3357931Z 
2025-11-28T00:37:43.3359718Z #10 [builder 4/8] RUN apt-get update -y && apt-get install -y openssl ca-certificates --no-install-recommends && rm -rf /var/lib/apt/lists/*  && npm ci --legacy-peer-deps --no-audit --no-fund
2025-11-28T00:37:43.3361022Z #10 CACHED
2025-11-28T00:37:43.3361416Z 
2025-11-28T00:37:43.3361873Z #11 [stage-1 5/6] COPY --from=builder /usr/src/app/node_modules ./node_modules
2025-11-28T00:37:43.3362261Z #11 CACHED
2025-11-28T00:37:43.3362432Z 
2025-11-28T00:37:43.3362801Z #12 [stage-1 4/6] COPY --from=builder /usr/src/app/src ./src
2025-11-28T00:37:43.3363302Z #12 CACHED
2025-11-28T00:37:43.3363483Z 
2025-11-28T00:37:43.3364823Z #13 [stage-1 3/6] RUN apt-get update -y && apt-get install -y openssl ca-certificates curl iproute2 procps --no-install-recommends && rm -rf /var/lib/apt/lists/*
2025-11-28T00:37:43.3365958Z #13 CACHED
2025-11-28T00:37:43.3366132Z 
2025-11-28T00:37:43.3366299Z #14 [builder 5/8] COPY . ./
2025-11-28T00:37:43.3366633Z #14 CACHED
2025-11-28T00:37:43.3366788Z 
2025-11-28T00:37:43.3367036Z #15 [builder 2/8] WORKDIR /usr/src/app
2025-11-28T00:37:43.3367294Z #15 CACHED
2025-11-28T00:37:43.3367397Z 
2025-11-28T00:37:43.3367965Z #16 [builder 6/8] RUN mkdir -p /usr/src/app/trained-models
2025-11-28T00:37:43.3368266Z #16 CACHED
2025-11-28T00:37:43.3368354Z 
2025-11-28T00:37:43.3368803Z #17 [builder 7/8] RUN mkdir -p prisma && cp ../shared/prisma/schema.prisma prisma/schema.prisma || true
2025-11-28T00:37:43.3369476Z #17 CACHED
2025-11-28T00:37:43.3369567Z 
2025-11-28T00:37:43.3369722Z #18 [stage-1 2/6] WORKDIR /usr/src/app
2025-11-28T00:37:43.3369945Z #18 CACHED
2025-11-28T00:37:43.3370037Z 
2025-11-28T00:37:43.3370313Z #19 [stage-1 6/6] COPY --from=builder /usr/src/app/trained-models ./trained-models
2025-11-28T00:37:43.3370663Z #19 CACHED
2025-11-28T00:37:43.3370750Z 
2025-11-28T00:37:43.3370837Z #20 exporting to image
2025-11-28T00:37:43.3371053Z #20 exporting layers done
2025-11-28T00:37:43.3371542Z #20 writing image sha256:bcfe3d4e743fde619b8b59adf21eb073abdae2fd845b2d3e08f8aeef984f0a6f done
2025-11-28T00:37:43.3372083Z #20 naming to docker.io/library/ai-e2e:1764290262296 done
2025-11-28T00:37:43.3372351Z #20 DONE 0.0s
2025-11-28T00:37:44.5529315Z Could not load @tensorflow/tfjs-node native bindings. Falling back to @tensorflow/tfjs (JS). Performance may be slower.
2025-11-28T00:37:44.5555857Z   console.log
2025-11-28T00:37:44.5556254Z     === ai-e2e logs ===
2025-11-28T00:37:44.5557478Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[NestFactory] [39m[32mStarting Nest application...[39m
2025-11-28T00:37:44.5558931Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[MachineLearningService] [39m[32mCargados 0 modelos desde disco[39m
2025-11-28T00:37:44.5560825Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mAppModule dependencies initialized[39m[38;5;3m +1ms[39m
2025-11-28T00:37:44.5562487Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mMulterModule dependencies initialized[39m[38;5;3m +0ms[39m
2025-11-28T00:37:44.5563861Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mAiModule dependencies initialized[39m[38;5;3m +1ms[39m
2025-11-28T00:37:44.5564798Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RoutesResolver] [39m[32mAiController {/api/ai}:[39m[38;5;3m +3ms[39m
2025-11-28T00:37:44.5566050Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/upload-excel, POST} route[39m[38;5;3m +2ms[39m
2025-11-28T00:37:44.5567020Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/train-model, POST} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:44.5568121Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/predict, POST} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:44.5570153Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/predict-with-weather, POST} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:44.5572013Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/models, GET} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:44.5573744Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/models/:id, GET} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:44.5575395Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/models/:id, DELETE} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:44.5577085Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/weather/current, GET} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:44.5578801Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/weather/forecast, GET} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:44.5580707Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/weather/status, GET} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:44.5582484Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/analyze-complete, POST} route[39m[38;5;3m +1ms[39m
2025-11-28T00:37:44.5584218Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/api/ai/health, GET} route[39m[38;5;3m +0ms[39m
2025-11-28T00:37:44.5585924Z     [32m[Nest] 1  - [39m11/28/2025, 12:37:44 AM [32m    LOG[39m [38;5;3m[NestApplication] [39m[32mNest application successfully started[39m[38;5;3m +1ms[39m
2025-11-28T00:37:44.5586693Z 
2025-11-28T00:37:44.5587205Z       at log (test/integration/predict-with-weather.http.integration.test.js:53:17)
2025-11-28T00:37:44.5587783Z 
2025-11-28T00:37:44.7243667Z FAIL test/integration/predict-with-weather.http.integration.test.js
2025-11-28T00:37:44.7244639Z   ai-service E2E POST /api/ai/predict-with-weather
2025-11-28T00:37:44.7245727Z     ✕ POST predict-with-weather returns prediction object (11 ms)
2025-11-28T00:37:44.7246168Z 
2025-11-28T00:37:44.7246960Z   ● ai-service E2E POST /api/ai/predict-with-weather › POST predict-with-weather returns prediction object
2025-11-28T00:37:44.7247648Z 
2025-11-28T00:37:44.7247876Z     expect(received).toHaveProperty(path)
2025-11-28T00:37:44.7248203Z 
2025-11-28T00:37:44.7248425Z     Expected path: "prediction"
2025-11-28T00:37:44.7248816Z     Received path: []
2025-11-28T00:37:44.7249304Z 
2025-11-28T00:37:44.7250644Z     Received value: {"error": "Bad Request", "message": "Error realizando predicción: Modelo m1 no encontrado", "statusCode": 400}
2025-11-28T00:37:44.7251418Z 
2025-11-28T00:37:44.7251818Z     [0m [90m  97 |[39m     [90m// basic shape checks[39m
2025-11-28T00:37:44.7252573Z      [90m  98 |[39m     expect(json)[33m.[39mtoBeDefined()[33m;[39m
2025-11-28T00:37:44.7253583Z     [31m[1m>[22m[39m[90m  99 |[39m     expect(json)[33m.[39mtoHaveProperty([32m'prediction'[39m)[33m;[39m
2025-11-28T00:37:44.7254737Z      [90m     |[39m                  [31m[1m^[22m[39m
2025-11-28T00:37:44.7255264Z      [90m 100 |[39m   })[33m;[39m
2025-11-28T00:37:44.7255711Z      [90m 101 |[39m })[33m;[39m
2025-11-28T00:37:44.7256130Z      [90m 102 |[39m[0m
2025-11-28T00:37:44.7256338Z 
2025-11-28T00:37:44.7256972Z       at Object.toHaveProperty (test/integration/predict-with-weather.http.integration.test.js:99:18)
2025-11-28T00:37:44.7257851Z 
2025-11-28T00:37:45.4095056Z   console.warn
2025-11-28T00:37:45.4096120Z     Could not load @tensorflow/tfjs-node native bindings. Falling back to @tensorflow/tfjs (JS). Performance may be slower.
2025-11-28T00:37:45.4096863Z 
2025-11-28T00:37:45.4097328Z       at Object.warn (src/ai-microservice/services/machine-learning.service.ts:12:8)
2025-11-28T00:37:45.4098193Z       at Object.require (src/ai-microservice/ai.controller.ts:17:1)
2025-11-28T00:37:45.4098934Z       at Object.require (test/predict-with-weather.spec.js:1:26)
2025-11-28T00:37:45.4099672Z 
2025-11-28T00:37:45.7687330Z PASS test/predict-with-weather.spec.js
2025-11-28T00:37:45.7687959Z   AiController.predictWithWeather
2025-11-28T00:37:45.7688824Z     ✓ calls mlService.predict with provided weatherData and returns prediction (1 ms)
2025-11-28T00:37:45.7689434Z 
2025-11-28T00:37:45.7705521Z Test Suites: 2 failed, 1 passed, 3 total
2025-11-28T00:37:45.7706124Z Tests:       2 failed, 1 passed, 3 total
2025-11-28T00:37:45.7706461Z Snapshots:   0 total
2025-11-28T00:37:45.7706688Z Time:        6.603 s
2025-11-28T00:37:45.7706898Z Ran all test suites.
2025-11-28T00:37:45.8954354Z ai-service tests failed
2025-11-28T00:37:45.8968909Z ##[error]Process completed with exit code 1.
